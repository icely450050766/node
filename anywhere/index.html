<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>node-anywhere</title>
    <script src="//apps.bdimg.com/libs/jquery/1.10.2/jquery.min.js"></script>
    <style>
        ul.directoryBox{
            margin: 0px;
            padding: 0px;
            width: 100%;
        }
        ul.directoryBox li{
            display: inline-block;
            text-align: center;
            width: 33%;
        }
        ul.directoryBox li a{
            cursor: pointer;
            line-height: 300%;
        }
        ul.directoryBox li a[isDirectory='true']::after{
            content: '（文件夹）';
        }
    </style>
</head>
<body>
    <h2>目录结构</h2>
    <ul class="directoryBox"></ul>

    <script>
        var index = ( function () {
            return{

                init: function () {
//                    console.log( window.location );
                    this.getDirectory();
                    this.addClickEvent();
                },

                // 请求目录
                getDirectory: function () {
                    $.ajax({
                        url: window.location.origin + "/api/getDirectory",
                        data: { "pathname": window.location.pathname },
                        type:"POST",
                        dataType: "json",
                        traditional: true,
                        success: function(data){
                            console.log( data );

                            var _content = '';
                            for( var i=0; i < data.length; i++ ){
                                _content += '<li><a isDirectory="' + data[i].isDirectory + '">'
                                        + data[i].name + '</a></li>'
                            }
                            $('.directoryBox').html( _content );
                        }
                    });
                },

                // 点击事件
                addClickEvent: function () {
                    var _self = this;

                    $(document).on('click', 'li a', function () {
                        var _href = window.location.href + $(this).text();
                        if( $(this).attr('isDirectory') == 'true' ) _href += '/';
                        window.location.href = _href;
                    });
                },

            }
        })();

        window.onload = function () {
            index.init();
        }
    </script>
</body>
</html>